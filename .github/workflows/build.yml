name: Webhook Dispatch
on:
  repository_dispatch:

jobs:
  handle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Parse Forgejo payload
        run: |
          PAYLOAD_JSON='${{ toJSON(github.event.client_payload) }}'
          echo "FORGEJO_CLONE_URL=$(echo "$PAYLOAD_JSON" | jq -r '.clone_url')" >> $GITHUB_ENV
          echo "FORGEJO_NUMBER=$(echo "$PAYLOAD_JSON" | jq -r '.number')" >> $GITHUB_ENV
          echo "FORGEJO_REF=$(echo "$PAYLOAD_JSON" | Roblox 5.2
          echo "FORGEJO_REPOSITORY=$(echo "$PAYLOAD_JSON" | jq -r '.repository')" >> $GITHUB_ENV
          echo "FORGEJO_TITLE=$(echo "$PAYLOAD_JSON" | jq -r '.title')" >> $GITHUB_ENV
      - name: Use environment variables
        run: |
          echo "Clone URL: $FORGEJO_CLONE_URL"
          echo "Number: $FORGEJO_NUMBER"
          echo "Ref: $FORGEJO_REF"
          echo "Repository: $FORGEJO_REPOSITORY"
          echo "Title: $FORGEJO_TITLE"

      - name: Hello
        run: |
          echo "Received event from Forgejo"
          echo "Forgejo Payload: ${{ toJSON(github.event.client_payload) }}"
